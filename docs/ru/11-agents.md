##### Агенты
Агент это долгоживущая программа (служба, демон), установленная и работающая на активе и выполняющая функции сбора информации, тестирования и установки исправлений.
В зависимости от конфигурации, собираемая агентом информация может включать:
- информацию об имеющемся на активе программном обеспечении;
- информацию, собранную из внешних баз данных (открытые или закрытые БДУ, БДЭ).
  Собранную информацию агент передает серверу управления, после чего очищает её.

**Задачи агента**

У агента 4 основной задачи, а именно:
- сбор информации (об активе, опрос внешних источников);
- тестирование изменений и обновлений;
- установка изменений или обновлений на актив;
- передача собранной информации вместе с отчетами на сервер управления.

Агент должен иметь возможность гибкой конфигурации, при которой выполняются только конкретные задачи, необходимые пользователю.

**Требования к агенту**

Требования к агенту очевидны из его задач, а именно:
- достаточный уровень *надежности* и *безотказности*;
- доступность - агент должен быть доступен на системах семейства UNIX и Windows;
- *безопасность* - поскольку агент это программа работающая на активе, необходимо исключить возможность появления слабого звена в защите актива, которым может стать агент;
- *унификация* - агент должен реализовывать соответствующие спецификации API;
- *расширяемость* - поскольку невозможно реализовать поддержку абсолютно каждого инструмента управления, необходимо предоставить API или иной механизм, с помощью которого сторонний разработчик сможет реализовать поддержку нужного ему инструмента.

**Виды активов**

Активы, на которых может быть запущен агент, разделяются на два типа: обычные активы и тестовый полигон.
Обычные активы предполагают максимальный уровень осторожности и надежности устанавливаемых обновлений. Агенты, установленные на обычном активе, устанавливают обновления, полученные только от управляющего сервера, либо через посредника, и прошедшие процесс тестирования на тестовом полигоне. Дополнительно, каждое устанавливаемое обновление проходит проверку цифровой подписи на соответствие с подписью, полученной от управляющего сервера.
Тестовый полигон это особый вид активов, на которых будет происходить процесс тестирования устанавливаемого обновления на наличие программных закладок и других угроз. Соответственно, каждый актив являющийся тестовым полигоном должен быть соответственно настроен, чтобы наиболее точно имитировать реальный актив, на котором будет установленно обновление в случае прохождения всех тестов, чтобы минимизировать ошибки.

**Каким способом будут собираться данные**

У агента будет 3 способа собирать информацию об активе:
- используя файловую систему
- используя вызов команд интерпретатора командной строки
- используя способы межпроцессной коммуникации

Через файловую систему будет выполняться сбор более низкоуровневой информации.
С помощью интерпретатора командной строки будет выполнять сбор информации из пакетных менеджеров.
С помощью межпроцессной коммуникации будет выполняться сбор информации из более продвинутых систем (таких, как средства контейнеризации и оркестрации), если это возможно.

**Какие данные собирать**

Для систем _GNU\\Linux_, агент будет собирать следующие данные:
- список установленных пакетов в пакетном менеджере, включая название пакета, версия, связанные и зависимые пакеты;
- информация об установленных локальных и глобальных пакетах в пакетном менеджере _pip_;
- информация об установленных локальных и глобальных пакетах в пакетном менеджере _composer_;
- информация об установленных локальных и глобальных пакетах в пакетном менеджере _npm_, _yarn_ и _bun_;
- информация об установленных локальных и глобальных пакетах в пакетном менеджере _go_;
- список исполняемых файлов, не находящихся под управлением какого-либо пакетного менеджера;
- список файлов, содержащих динамически интерпретируемый код;
- информация об операционной системе и установленных модулях ядра;
- информация о подсистеме управления службами и службах;
- информация о системах контейнеризации и контейнерах;
- информация о системах оркестрации.

**Режимы связи с сервером управления**

У агента будет два способа осуществления связи с сервером управления:
1. **push**-режим;
2. **pull**-режим.

Оба режима предполагают регламентированное общение с помощью API. К каждому API прилагается своя спецификация.
В первом режиме агент принимает активную роль и самостоятельно собирает и отправляет данные на сервер управления, а так же опрашивает его на наличие команд. Данный режим предпочтителен когда нет необходимости в жестком централизованном контроле со стороны сервера управления, а так же когда использование второго режима недопустимо из за политики безопасности или иных причин. Для использования данного режима, сервер управления должен удовлетворять соответствующей спецификации API.
Во втором режиме агент принимает пассивную роль и ждет команд со стороны сервера управления. Без команды со стороны сервера управления, агент не будет делать ничего, в том числе не будет собирать данные. Данный режим предпочтителен когда требуется полный централизованный контроль, а так же когда политика безопасности позволяет иметь один открытый порт для агента. Для использования этого режима, агент должен удовлетворять соответствующей спецификации API.

**Режимы работы агента**

Бывают случаи, когда актив имеет слишком высокие требования к стабильности и надежности, из-за чего даже теоретическая возможность установки исправления агентом не приемлема.
Для таких случаев в конфигурации агента можно будет указать запрет на установку исправлений или любые действия, которые могут повлиять на работу и стабильность актива. В таком случае агент будет выполнять исключительно сбор информации выполняя только чтение системных файлов, и, возможно, безвредные команды для сбора информации из систем управления пакетами. Даже если будет получена команда от сервера управления, никаких действий выполнено не будет.
